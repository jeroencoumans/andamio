window.Andamio={},Andamio.dom=function(){return{win:$(window),doc:$(window.document),html:$("html"),viewport:$(".viewport"),pageView:$(".js-page-view"),parentView:$(".js-parent-view"),childView:$(".js-child-view"),childViewAlt:$(".js-child-view-alternate"),modalView:$(".js-modal-view")}}(),Andamio.i18n={ajaxGeneralError:"Computer said no:",ajaxNotFound:"The page couldn't be found.",ajaxTimeout:"The server timed out waiting for the request.",ajaxServerError:"The server is having problems, try again later.",ajaxRetry:"Please go back or try again.",offlineMessage:"There was a problem. Is your connection working? <br>Please check and try again.",pagerLoadMore:"Load more",pagerLoading:"Loading&hellip;",pagerNoMorePages:"There are no more items.",relativeDates:{ago:"ago",from:"",now:"Just now",minute:"Minute",minutes:"Minutes",hour:"Hour",hours:"Hours",day:"Day",days:"Days",week:"Week",weeks:"Weeks",month:"Month",months:"Months",year:"Year",years:"Years"}},Andamio.config=function(){var e=function(e){var i=this.os={},t=this.browser={},n=e.match(/WebKit\/([\d.]+)/),o=e.match(/(Android)\s+([\d.]+)/),a=e.match(/(iPad).*OS\s([\d_]+)/),s=!a&&e.match(/(iPhone\sOS)\s([\d_]+)/),r=e.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),d=r&&e.match(/TouchPad/),l=e.match(/Kindle\/([\d.]+)/),c=e.match(/Silk\/([\d._]+)/),h=e.match(/(BlackBerry).*Version\/([\d.]+)/),m=e.match(/(BB10).*Version\/([\d.]+)/),u=e.match(/(RIM\sTablet\sOS)\s([\d.]+)/),f=e.match(/PlayBook/),p=e.match(/Chrome\/([\d.]+)/)||e.match(/CriOS\/([\d.]+)/),g=e.match(/Firefox\/([\d.]+)/);(t.webkit=!!n)&&(t.version=n[1]),o&&(i.android=!0,i.version=o[2]),s&&(i.ios=i.iphone=!0,i.version=s[2].replace(/_/g,".")),a&&(i.ios=i.ipad=!0,i.version=a[2].replace(/_/g,".")),r&&(i.webos=!0,i.version=r[2]),d&&(i.touchpad=!0),h&&(i.blackberry=!0,i.version=h[2]),m&&(i.bb10=!0,i.version=m[2]),u&&(i.rimtabletos=!0,i.version=u[2]),f&&(t.playbook=!0),l&&(i.kindle=!0,i.version=l[1]),c&&(t.silk=!0,t.version=c[1]),!c&&i.android&&e.match(/Kindle Fire/)&&(t.silk=!0),p&&(t.chrome=!0,t.version=p[1]),g&&(t.firefox=!0,t.version=g[1]),i.tablet=!!(a||f||o&&!e.match(/Mobile/)||g&&e.match(/Tablet/)),i.phone=!(i.tablet||!(o||s||r||h||m||p&&e.match(/Android/)||p&&e.match(/CriOS\/([\d.]+)/)||g&&e.match(/Mobile/)))};return{get webapp(){return Andamio.dom.html.hasClass("webapp")},set webapp(e){e?Andamio.dom.html.removeClass("website").addClass("webapp"):Andamio.dom.html.removeClass("webapp").addClass("website")},init:function(i){e.call(this,navigator.userAgent),this.os.ios&&(this.os.ios5=-1!==this.os.version.indexOf("5."),this.os.ios6=-1!==this.os.version.indexOf("6.")),this.os.android&&(this.os.android2=this.os.version>="2"&&"4">this.os.version,this.os.android4=this.os.version>="4"&&"5">this.os.version);var t=window;if(this.webapp=t.location.search.search("webapp")>0||t.navigator.standalone,this.website=!this.webapp,this.tmgcontainer=t.navigator.userAgent.indexOf("TMGContainer")>-1,this.server=t.location.origin+t.location.pathname,this.touch="ontouchstart"in t,this.cache=window.lscache?window.lscache.supported():!1,Andamio.dom.doc.width()>=980&&(this.os.tablet=!0),this.cache&&(this.cacheExpiration=120),this.touch?this.fastclick=new FastClick(t.document.body):Andamio.dom.html.addClass("no-touch"),"object"==typeof i)for(var n in i)switch(n){case"init":break;case"i18n":for(var o in i.i18n)Andamio.i18n[o]=i.i18n[o];break;default:this[n]=i[n]}this.tmgcontainer&&(this.webapp=!0),this.os.tablet&&(Andamio.dom.html.addClass("tablet"),Andamio.nav.show(),this.webapp=!0);for(var a in this.os)Andamio.config.os[a]&&"version"!==a&&Andamio.dom.html.addClass(a)}}}(),Andamio.events=function(){var e,i=!1;return{get status(){return i},lock:function(t){i||(i=!0,t="number"==typeof t&&t>0?t:300,e=setTimeout(function(){i=!1},t))},unlock:function(){clearTimeout(e),i=!1},attach:function(e,t,n){Andamio.dom.viewport.on("click",e,function(e){return i||(n&&Andamio.events.lock(),t(e)),!1})}}}(),Andamio.util=function(){return{getUrl:function(e){var i=$(e).data("url"),t=$(e).attr("href"),n=$(e).hash;return i?encodeURI(i):"javascript"!==t.substring(0,10)?encodeURI(t):n?encodeURIComponent(n):void 0},getUrlList:function(e){if(e){var i=[];return $(e).each(function(e,t){var n=Andamio.util.getUrl(t);n&&i.push(n)}),i}},getTitle:function(e){var i=$(e).data("title"),t=$(e).text();return i?i:t},relativeDate:function(e){return e instanceof Date?humaneDate(e,!1,{lang:Andamio.i18n.relativeDates}):void 0}}}(),Andamio.util.delay=function(){var e=0;return function(i,t){clearTimeout(e),e=setTimeout(i,t)}}(),Andamio.tmgcontainer=function(){var e,i,t,n;return{init:function(){Andamio.config.phone={updateTimestamp:new Date,updateTimeout:18e5},navigator.bootstrap.addConstructor(function(){cordova.exec(null,null,"SplashScreen","hide",[]),Andamio.events.attach('a[target="_blank"]',function(t){return e=$(t.currentTarget),i=e.attr("href"),navigator.utility.openUrl(i,"popover"),!1}),Andamio.dom.doc.on("statusbartap",function(){t=Andamio.nav.status?Andamio.dom.pageNav:Andamio.views.currentView.scroller,$.scrollTo?t.scrollTo(0,400):$.scrollElement&&$.scrollElement(t[0],0)}),Andamio.dom.doc.on("resign",function(){Andamio.config.phone.updateTimestamp=new Date}),Andamio.dom.doc.on("active",function(){n=new Date,n-Andamio.config.phone.updateTimestamp>Andamio.config.phone.updateTimeout&&(Andamio.alert.status&&Andamio.alert.hide(),Andamio.views.currentView===Andamio.views.parentView&&Andamio.views.refreshView())})})}}}(),Andamio.cache=function(){function e(e){var i,t,n="";for(0!==e.length%2&&(e+=" "),i=0,t=e.length;t>i;i+=2)n+=String.fromCharCode(256*e.charCodeAt(i)+e.charCodeAt(i+1));return String.fromCharCode(9731)+n}function i(e){var i,t,n,o,a="";if(9731!==e.charCodeAt(0))return e;for(i=1,t=e.length;t>i;i++)n=e.charCodeAt(i),o=Math.floor(n/256),a+=String.fromCharCode(o,n%256);return a}var t;return{get:function(e){if(e&&t){var n=t.get(e);if(n)return i(n)}},set:function(i,n,o){if(i&&n&&t){var a="number"==typeof o?o:Andamio.config.cacheExpiration;t.set(i,e(n),a)}},"delete":function(e){e&&t&&t.remove(e)},init:function(){Andamio.config.cache?(t=window.lscache,Andamio.config.cacheExpiration=120):t=!1}}}(),Andamio.connection=function(){var e;return{goOnline:function(){e=!0,Andamio.alert.hide()},goOffline:function(){if(e){e=!1;var i=$('<a href="javascript:void(0)" class="action-refresh">'+Andamio.i18n.offlineMessage+"</a>");Andamio.alert.show(i)}},get status(){return e},init:function(){e=navigator.onLine}}}(),Andamio.dom.refreshDate=$(".js-refresh-date"),Andamio.page=function(){function e(e,i,t,n){$.ajax({url:e,cache:t,headers:{"X-PJAX":!0,"X-Requested-With":"XMLHttpRequest"},error:function(e,i){var t=e.status,n='<a href="javascript:void(0)" class="action-refresh">'+Andamio.i18n.ajaxGeneralError+"<br>"+i+" "+t+"<br>"+Andamio.i18n.ajaxRetry+"</a>";"timeout"===i?Andamio.connection.goOffline():Andamio.connection.status&&Andamio.alert.show(n)},success:function(t){Andamio.connection.goOnline(),Andamio.cache.set(e,t,i),n(t)}})}var i,t;return{get lastUpdate(){return i},set lastUpdate(e){i=e instanceof Date?e:new Date,Andamio.dom.refreshDate.text(Andamio.util.relativeDate(i))},load:function(i,n,o,a){clearInterval(t);var s=this,r=function(e){Andamio.dom.refreshDate.length>0&&(t=window.setInterval(function(){Andamio.dom.refreshDate.text(Andamio.util.relativeDate(s.lastUpdate))},6e4)),$.isFunction(a)&&a(e)};if(i){var d=Andamio.cache.get(i);d?(s.lastUpdate=new Date,r(d)):e(i,n,o,function(e){s.lastUpdate=new Date,r(e)})}},refresh:function(e,i,t){Andamio.cache.delete(e),this.load(e,i,!1,t)}}}(),Andamio.pager=function(){function e(){c.show(),l.hide()}function i(){c.hide(),l.show()}function t(){d||Andamio.util.delay(function(){m=u.scrollTop(),m+f+r.autoFetchThreshold>=p&&a.loadNextPage(function(e){e>=r.autoFetchMax?o():(f=u.height(),p=u[0].scrollHeight||Andamio.dom.viewport.height())})},300)}function n(){c.show(),l.hide(),f=u.height(),p=u[0].scrollHeight||Andamio.dom.viewport.height(),u.on("scroll",t)}function o(){u.off("scroll",t),c.hide(),l.show()}var a,s,r,d,l,c,h,m,u,f,p;return{enable:function(){r.pagerWrapper.length>0&&r.itemsPerPage<=r.pagerWrapper[0].children.length&&(s=!0,l.on("click",a.loadNextPage).insertAfter(r.pagerWrapper),c.insertAfter(r.pagerWrapper).hide(),r.autoFetch&&n())},disable:function(){s=!1,l.off("click",a.loadNextPage).remove(),c.remove(),h.insertAfter(r.pagerWrapper),r.autoFetch&&o()},get status(){return s},get options(){return r},loadNextPage:function(t){d||(d=!0,r.autoFetch||e(),r.pageNumber++,Andamio.page.load(r.url+r.pageNumber,r.expires,!0,function(e){d=!1,r.autoFetch||i();var n=!1,o=document.createElement("div");e&&($.isPlainObject(e)?$.isEmptyObject(e.content)||(n=e.content):n=e),o.insertAdjacentHTML("beforeend",n),o.childElementCount>0&&r.pagerWrapper.append(n),o.childElementCount<r.itemsPerPage&&a.disable(),$.isFunction(t)&&t(r.pageNumber),$.isFunction(r.callback)&&r.callback(r.pageNumber)}))},init:function(e){return r={autoFetch:!0,autoFetchMax:3,autoFetchThreshold:100,callback:function(){},expires:null,itemsPerPage:10,pageNumber:0,pagerWrapper:Andamio.views.currentView.content.find(".js-pager-list"),url:Andamio.config.server+"?page="},l=$('<div class="pager-action"><a href="javascript:void(0)" class="button button-block action-load-more">'+Andamio.i18n.pagerLoadMore+"</a></div>"),c=$('<div class="pager-loading">'+Andamio.i18n.pagerLoading+"</div></div>"),h=$('<div class="pager-action">'+Andamio.i18n.pagerNoMorePages+"</div>"),u=Andamio.views.currentView.scroller,$.extend(r,e),a=this,a.enable(),a}}}(),Andamio.dom.pageAlert=$(".js-page-alert"),Object.defineProperties(Andamio.dom,{pageAlertText:{get:function(){return this.pageAlert.find(".js-page-alert-text").text()},set:function(e){this.pageAlert.find(".js-page-alert-text").html(e)}}}),Andamio.alert=function(){var e;return{show:function(i){i&&(Andamio.dom.pageAlertText=i),e=!0,Andamio.dom.html.addClass("has-alert"),Andamio.dom.pageAlert.show()},hide:function(){e=!1,Andamio.dom.html.removeClass("has-alert"),Andamio.dom.pageAlert.hide()},get status(){return e},init:function(){e=Andamio.dom.html.hasClass("has-alert"),Andamio.events.attach(".action-hide-alert",this.hide),Andamio.dom.doc.on("Andamio:views:activateView:start",this.hide)}}}(),Andamio.dom.pageLoader=$(".js-page-loader"),Andamio.dom.pageLoaderImg=Andamio.dom.pageLoader.find(".js-page-loader-spinner"),Object.defineProperties(Andamio.dom,{pageLoaderText:{get:function(){return this.pageLoader.find(".js-page-loader-text").text()},set:function(e){this.pageLoader.find(".js-page-loader-text").html(e)}}}),Andamio.loader=function(){var e;return{show:function(i){e=!0,i&&(Andamio.dom.pageLoaderText=i),Andamio.dom.html.addClass("has-loader"),Andamio.config.tmgcontainer?navigator.spinner&&navigator.spinner.show({message:i}):Andamio.dom.pageLoader.show()},hide:function(){e=!1,Andamio.dom.html.removeClass("has-loader"),Andamio.config.tmgcontainer?navigator.spinner&&navigator.spinner.hide():Andamio.dom.pageLoader.hide()},get status(){return e},init:function(){e=Andamio.dom.html.hasClass("has-loader");var i,t=this;Andamio.dom.doc.on("Andamio:views:activateView:start",function(){i=setTimeout(function(){t.show()},250)}),Andamio.dom.doc.on("Andamio:views:activateView:finish",function(){clearTimeout(i),t.hide()}),Andamio.dom.doc.on("ajaxError",function(){clearTimeout(i),t.hide()})}}}(),Andamio.dom.pageNav=$(".js-page-navigation"),Andamio.dom.pageNavItems=Andamio.dom.pageNav.find(".action-nav-item"),Object.defineProperties(Andamio.dom,{pageNavActive:{get:function(){return this.pageNavItems.filter(".active")},set:function(e){$.contains(this.pageNav[0],e[0])&&(this.pageNavActive.removeClass("active"),e.addClass("active"))}}}),Andamio.nav=function(){function e(e){Andamio.dom.viewport.height(e),Andamio.dom.pageView.height(e)}var i,t,n;return{show:function(){i=!0,Andamio.events.lock(),Andamio.dom.html.addClass("has-navigation"),Andamio.config.webapp||e(n)},hide:function(){i=!1,Andamio.events.lock(),Andamio.dom.html.removeClass("has-navigation"),Andamio.config.webapp||e("")},get status(){return i},init:function(){var e=this;i=Andamio.dom.html.hasClass("has-navigation"),Andamio.config.webapp||(t=Andamio.dom.win.height(),n=Andamio.dom.pageNav.height(),Andamio.config.os.iphone&&(t+=60),t>n&&(n=t,Andamio.dom.pageNav.height(n))),Andamio.events.attach(".action-show-nav",e.show),Andamio.events.attach(".action-hide-nav",e.hide),Andamio.dom.doc.on("touchmove",".action-hide-nav",function(e){e.preventDefault()}),Andamio.events.attach(".action-nav-item",function(i){var t=$(i.currentTarget),n=Andamio.util.getUrl(t),o=Andamio.util.getTitle(t);return Andamio.dom.pageNavActive[0]!==t[0]||Andamio.config.os.tablet?(Andamio.dom.pageNavActive=t,Andamio.config.os.tablet||e.hide(),o&&Andamio.dom.doc.one("Andamio:views:activateView:finish",function(){Andamio.views.parentView.title=o}),n&&Andamio.views.openParentPage(n),void 0):(e.hide(),void 0)})}}}(),Andamio.pulltorefresh=function(){function e(){a=s.scroller[0].scrollTop,s.threshold>a?s.scroller.addClass("can-refresh"):s.scroller.removeClass("can-refresh")}function i(){o=!1,s.scroller.removeClass("is-refreshing"),s.callback()}function t(){a=s.scroller[0].scrollTop,s.threshold>a&&(o=!0,s.scroller.addClass("is-refreshing").removeClass("can-refresh"),Andamio.views.refreshView(null,i))}var n,o,a,s;return{get status(){return n},get loading(){return o},get options(){return s},enable:function(){n=!0,s.scroller.addClass("has-pull-to-refresh").on("touchmove",e).on("touchend",t)},disable:function(){n=!1,s.scroller.removeClass("has-pull-to-refresh").off("touchmove",e).off("touchend",t)},init:function(e){n=!1,s={scroller:Andamio.views.parentView.scroller,callback:function(){},threshold:-50},$.extend(s,e),this.enable()}}}(),Andamio.reveal=function(){return{init:function(){Andamio.events.attach(".action-reveal",function(e){var i,t,n,o="active",a="."+o,s=$(e.currentTarget);s&&(i=s.siblings(a),i&&i.removeClass(o),s.addClass(o),n=Andamio.util.getUrl(s),n&&(t=$(n).siblings(a),t&&t.removeClass("active"),$(n).addClass(o),e.preventDefault()))})}}}(),Andamio.slideshow=function(){function e(e){if("number"==typeof e){this.wrapper=$('<div class="slideshow-dots">');for(var i=0;e>i;i++)this.wrapper.append($('<div class="slideshow-dot"></div>'));this.items=this.wrapper.find(".slideshow-dot"),Object.defineProperties(this,{active:{get:function(){return this.wrapper.find(".active")},set:function(e){this.wrapper.find(".active").removeClass("active"),$(e).addClass("active")}}}),this.active=this.items.first()}}var i,t,n;return{destroy:function(){n.wrapper.off("click"),t.off("click"),i.kill(),t=null,i=null,n=null},init:function(o,a,s){if(t=$("#"+o),!t.hasClass(".js-slideshow-active")){var r={startSlide:0,speed:300,continuous:!0,disableScroll:!1};return this.options=$.extend({},r,a),i=this.slideshow=new Swipe(document.getElementById(o),this.options),n=this.dots=new e(i.length),n.wrapper.insertAfter(i.container).on("click",function(e){var t=e.target;n.items.each(function(e,n){n===t&&i.slide(e,300)})}),i.callback=function(e,i){n.active=n.items[e],$.isFunction(s)&&s(e,i)},t.find(".js-slideshow-media").each(function(e,i){var t=$(i),n=t.data("src");t.css("background-image","url("+n+")")}),t.on("click",function(e){var t=$(e.target),n=t.parents(".action-slideshow-next"),o=t.parents(".action-slideshow-prev");n.length&&i.next(),o.length&&i.prev()}),t.addClass("js-slideshow-active"),this}}}}(),Andamio.dom.pageTabs=$(".js-page-tabs"),Andamio.dom.pageTabsItems=Andamio.dom.pageTabs.find(".action-tab-item"),Object.defineProperties(Andamio.dom,{pageTabsActive:{get:function(){return this.pageTabsItems.filter(".active")},set:function(e){$.contains(this.pageTabs[0],e[0])&&(this.pageTabsActive.removeClass("active"),e.addClass("active"))}}}),Andamio.tabs=function(){var e;return{show:function(){e=!0,Andamio.dom.html.addClass("has-page-tabs")},hide:function(){e=!1,Andamio.dom.html.removeClass("has-page-tabs")},get status(){return e},init:function(){e=Andamio.dom.html.hasClass("has-page-tabs"),Andamio.events.attach(".action-show-tabs",Andamio.tabs.show),Andamio.events.attach(".action-hide-tabs",Andamio.tabs.hide),Andamio.events.attach(".action-tab-item",function(e){var i=$(e.currentTarget),t=Andamio.util.getUrl(i),n=Andamio.util.getTitle(i);Andamio.dom.pageTabsActive[0]!==i[0]&&(Andamio.dom.pageTabsActive=i,n&&Andamio.dom.doc.one("Andamio:views:activateView:finish",function(){Andamio.views.parentView.title=n}),Andamio.views.openParentPage(t))})}}}(),Andamio.views=function(){function e(e){return e.length>0?e[e.length-1]:void 0}function i(e){return e&&e.length>1?e[e.length-2]:void 0}function t(i,t){i!==e(t)&&t.push(i)}function n(e,i){this.container=e,Object.defineProperties(this,{title:{configurable:!0,get:function(){return this.container.find(".js-title")},set:function(e){"string"==typeof e&&this.container.find(".js-title").text(e)}},content:{configurable:!0,get:function(){return this.container.hasClass("js-content")?this.container:this.container.find(".js-content")}},scroller:{configurable:!0,get:function(){return Andamio.config.webapp?this.container.hasClass("overthrow")?this.container:this.container.find(".overthrow"):Andamio.dom.win}},active:{get:function(){return this.container.hasClass("view-active")},set:function(e){e?this.container.addClass("view-active").removeClass("view-hidden"):this.container.addClass("view-hidden").removeClass("view-active")}}}),i&&(this.initialPosition=i,this.position=i,this.slide=function(e){var i=this.container,t=this.position;Andamio.events.lock(),"slide-left"===t&&"slide-default"===e&&i.addClass("slide-in-from-left").one("webkitTransitionEnd",function(){i.addClass("slide-default").removeClass("slide-left slide-right slide-in-from-left")}),"slide-right"===t&&"slide-default"===e&&i.addClass("slide-in-from-right").one("webkitTransitionEnd",function(){i.addClass("slide-default").removeClass("slide-right slide-left slide-in-from-right")}),"slide-bottom"===t&&"slide-default"===e&&i.addClass("slide-in-from-bottom").one("webkitTransitionEnd",function(){i.addClass("slide-default").removeClass("slide-bottom slide-in-from-bottom")}),"slide-top"===t&&"slide-default"===e&&i.addClass("slide-in-from-top").one("webkitTransitionEnd",function(){i.addClass("slide-default").removeClass("slide-top slide-in-from-top")}),"slide-default"===t&&"slide-left"===e&&i.addClass("slide-out-to-left").one("webkitTransitionEnd",function(){i.addClass("slide-left").removeClass("slide-default slide-out-to-left")}),"slide-default"===t&&"slide-right"===e&&i.addClass("slide-out-to-right").one("webkitTransitionEnd",function(){i.addClass("slide-right").removeClass("slide-default slide-out-to-right")}),"slide-default"===t&&"slide-bottom"===e&&i.addClass("slide-out-to-bottom").one("webkitTransitionEnd",function(){i.addClass("slide-bottom").removeClass("slide-default slide-out-to-bottom")}),"slide-default"===t&&"slide-top"===e&&i.addClass("slide-out-to-top").one("webkitTransitionEnd",function(){i.addClass("slide-top").removeClass("slide-default slide-out-to-top")}),this.position=e})}n.prototype.reset=function(){this.position&&Andamio.config.webapp&&(this.position=this.initialPosition,this.container.removeClass("slide-left slide-right slide-default slide-bottom").addClass(this.position)),this.active=!1};var o,a,s,r;return{parentView:new n(Andamio.dom.parentView,"slide-default"),childView:new n(Andamio.dom.childView,"slide-right"),childViewAlt:new n(Andamio.dom.childViewAlt,"slide-right"),modalView:new n(Andamio.dom.modalView,"slide-bottom"),urlHistory:[],viewHistory:[],scrollHistory:[],childCount:0,modalCount:0,get currentUrl(){return e(this.urlHistory)},set currentUrl(e){t(e,this.urlHistory)},get previousUrl(){return i(this.urlHistory)},get currentView(){return e(this.viewHistory)},set currentView(e){this.viewHistory.push(e)},get previousView(){return i(this.viewHistory)},get scrollPosition(){return e(this.scrollHistory)},set scrollPosition(e){this.scrollHistory.push(e)},resetViews:function(){this.parentView.reset(),this.childView.reset(),this.childViewAlt.reset(),this.modalView.reset(),this.viewHistory=[],this.urlHistory=[],this.scrollHistory=[],this.childCount=0,this.modalCount=0},activateView:function(e,i,t,n){e.active=!0,i&&(Andamio.dom.doc.trigger("Andamio:views:activateView:start",[e,i]),e.content.empty(),Andamio.page.load(i,t,!0,function(t){e.content.html(t),"number"==typeof n&&(e.scroller[0].scrollTop=n),Andamio.dom.doc.trigger("Andamio:views:activateView:finish",[e,i])}))},deactivateView:function(e){e.active=!1},pushView:function(e,i,t,n){this.currentView=e,i&&(this.currentUrl=i),this.previousView&&(this.scrollPosition=this.previousView.scroller[0].scrollTop,this.deactivateView(this.previousView)),this.activateView(e,i,t,n)},popView:function(){this.previousView&&(this.deactivateView(this.currentView),1===this.childCount?this.activateView(this.previousView):this.activateView(this.previousView,this.previousUrl,!1,this.scrollPosition),this.viewHistory.pop(),this.scrollHistory.pop(),this.urlHistory.length>1&&this.urlHistory.pop())},refreshView:function(e,i){var t=this.currentUrl,n=this.currentView,o=n.content;t&&(Andamio.dom.doc.trigger("Andamio:views:activateView:start",[n,t]),o.empty(),Andamio.page.refresh(t,e,function(e){o.html(e),Andamio.dom.doc.trigger("Andamio:views:activateView:finish",[n,t]),$.isFunction(i)&&i()}))},openParentPage:function(e,i){this.resetViews(),this.pushView(o,e,i,0)},pushModal:function(e,i){return this.modalCount>0?!1:(Andamio.config.webapp&&this.modalView.slide("slide-default"),this.pushView(this.modalView,e,i),this.modalCount++,void 0)},popModal:function(){return this.modalCount>0?(Andamio.config.webapp&&this.modalView.slide("slide-bottom"),this.popView(),this.modalCount--,void 0):!1},pushChild:function(e,i){switch(this.childCount++,this.currentView){case o:this.pushView(a,e,i,0),Andamio.config.webapp&&(o.slide("slide-left"),a.slide("slide-default"));break;case a:this.pushView(s,e,i,0),Andamio.config.webapp&&(s.container.removeClass("slide-left").addClass("slide-right"),Andamio.util.delay(function(){a.slide("slide-left"),s.slide("slide-default")},0));break;case s:this.pushView(a,e,i,0),Andamio.config.webapp&&(a.container.removeClass("slide-left").addClass("slide-right"),Andamio.util.delay(function(){s.slide("slide-left"),a.slide("slide-default")},0))}},popChild:function(){var e=this.currentView;if(Andamio.config.webapp)switch(e){case o:return;case a:1===this.childCount?(o.slide("slide-default"),a.slide("slide-right")):(s.container.removeClass("slide-right").addClass("slide-left"),Andamio.util.delay(function(){a.slide("slide-right"),s.slide("slide-default")},0));break;case s:a.container.removeClass("slide-right").addClass("slide-left"),Andamio.util.delay(function(){s.slide("slide-right"),a.slide("slide-default")},0)}this.popView(),this.childCount--},init:function(){var e,i,t=this;o=this.parentView,a=this.childView,s=this.childViewAlt,r=this.modalView,"string"==typeof Andamio.config.initialView?t.openParentPage(Andamio.config.initialView):(t.openParentPage(),t.currentUrl=Andamio.config.server),Andamio.events.attach(".action-push",function(n){e=$(n.currentTarget),i=Andamio.util.getUrl(e),t.pushChild(i)}),Andamio.events.attach(".action-show-modal",function(n){e=$(n.currentTarget),i=Andamio.util.getUrl(e),t.pushModal(i)}),Andamio.events.attach(".action-pop",function(){t.popChild()}),Andamio.events.attach(".action-hide-modal",function(){t.popModal()}),Andamio.events.attach(".action-refresh",function(){t.refreshView()})}}}(),Andamio.init=function(e){Andamio.config.init(e),Andamio.alert.init(),Andamio.cache.init(),Andamio.connection.init(),Andamio.loader.init(),Andamio.views.init(),Andamio.nav.init(),Andamio.reveal.init(),Andamio.config.webapp&&Andamio.tabs.init(),Andamio.config.tmgcontainer&&Andamio.tmgcontainer.init()};