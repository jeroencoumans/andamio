window.Andamio={},Andamio.dom=function(){return{win:$(window),doc:$(window.document),html:$("html"),viewport:$(".viewport")}}(),Andamio.i18n={ajaxGeneralError:"Computer said no:",ajaxNotFound:"The page couldn't be found.",ajaxTimeout:"The server timed out waiting for the request.",ajaxServerError:"The server is having problems, try again later.",ajaxRetry:"Load again",offlineMessage:"It seems your internet connection is offline.",pageLoaderText:"Loading&hellip;",pagerLoadMore:"Load more",pagerLoading:"Loading&hellip;",pagerNoMorePages:"There are no more items.",pagerErrorMessage:"There was an error loading more pages"},Andamio.config=function(){return{init:function(a){$.os.ios&&($.os.ios5=-1!==$.os.version.indexOf("5."),$.os.ios6=-1!==$.os.version.indexOf("6.")),$.os.android&&($.os.android2=$.os.version>="2"&&$.os.version<"4",$.os.android4=$.os.version>="4"&&$.os.version<"5");var b=window;if(this.webapp=b.location.search.search("webapp")>0||b.navigator.standalone||Andamio.dom.html.hasClass("webapp"),this.tmgcontainer=b.navigator.userAgent.indexOf("TMGContainer")>-1,this.server=b.location.origin+b.location.pathname,this.touch="ontouchstart"in b,this.cache=window.lscache?window.lscache.supported():!1,this.expiration={all:1440,parentView:30},Andamio.dom.doc.width()>=980&&($.os.tablet=!0),this.touch?this.fastclick=new FastClick(b.document.body):Andamio.dom.html.addClass("no-touch"),"object"==typeof a)for(var c in a)switch(c){case"init":break;case"i18n":for(var d in a.i18n)Andamio.i18n[d]=a.i18n[d];break;default:this[c]=a[c]}this.tmgcontainer&&(this.webapp=!0),$.os.tablet&&(Andamio.dom.html.addClass("tablet"),Andamio.nav.show(),this.webapp=!0),$.os.android&&(this.webapp=!1),this.webapp?Andamio.dom.html.removeClass("website").addClass("webapp"):Andamio.dom.html.removeClass("webapp").addClass("website"),this.website=!this.webapp;for(var e in $.os)$.os[e]&&"version"!==e&&Andamio.dom.html.addClass(e)}}}(),Andamio.events=function(){var a,b=!1;return{get status(){return b},lock:function(c){b||(b=!0,c="number"==typeof c&&c>0?c:300,a=setTimeout(function(){b=!1},c))},unlock:function(){clearTimeout(a),b=!1},attach:function(a,c,d,e){Andamio.dom.viewport.on("click",a,function(a){return b||(d&&Andamio.events.lock(e),c(a)),!1})},detach:function(a){Andamio.dom.viewport.off("click",a)}}}(),Andamio.util=function(){return{last:function(a){return a.length>0?a[a.length-1]:void 0},prev:function(a){return a&&a.length>1?a[a.length-2]:void 0},addUniq:function(a,b){a!==this.last(b)&&b.push(a)},addOnly:function(a,b){b.indexOf(a)<0&&b.push(a)},getUrl:function(a){var b=0!==$(a).attr("href").indexOf("javascript")?$(a).attr("href"):!1;return $(a).data("url")||b||$(a).hash},getTitle:function(a){return $(a).data("title")||$(a).text()}}}(),Andamio.util.delay=function(){var a=0;return function(b,c){clearTimeout(a),a=setTimeout(b,c)}}(),Andamio.container=function(){function a(){Andamio.config.phone={updateTimestamp:new Date,updateTimeout:1e3*Andamio.config.expiration.parentView},navigator.splashscreen&&navigator.splashscreen.hide(),Andamio.events.attach(".action-external",function(a){var b=$(a.currentTarget),c=b.attr("href");navigator.utility&&navigator.utility.openUrl&&navigator.utility.openUrl(c,"popover")}),Andamio.dom.doc.on("statusbartap",function(){var a=Andamio.nav.status?Andamio.dom.pageNav:Andamio.views.currentView.scroller;$.scrollTo?a.scrollTo(0,400):$.scrollElement&&$.scrollElement(a[0],0)}),Andamio.dom.doc.on("pause",function(){Andamio.config.phone.updateTimestamp=new Date}),Andamio.dom.doc.on("resume",function(){var a=new Date;a-Andamio.config.phone.updateTimestamp>Andamio.config.phone.updateTimeout&&Andamio.views.refreshView(Andamio.views.parentView)})}return{init:function(){navigator.bootstrap?navigator.bootstrap.addConstructor(a):Andamio.dom.doc.on("deviceready",a)}}}(),Andamio.cache=function(){var a,b=function(b){a&&a.setBucket(b)},c=function(a){b(""),a!=Andamio.cache.get("app_version")&&(b(Andamio.cache.get("app_version")),Andamio.cache.flush(),b(""),Andamio.cache.set("app_version",a)),b(a)};return{get:function(b){if(b&&a){var c=a.get(b);if(c)return c}},set:function(b,c,d){if(b&&c&&a){var e="number"==typeof d?d:Andamio.config.expiration.all;a.set(b,c,e)}},remove:function(b){b&&a&&a.remove(b)},flush:function(){a&&a.flush()},init:function(){a=Andamio.config.cache?window.lscache:!1,a&&Andamio.config.cache_version&&c(Andamio.config.cache_version)}}}(),Andamio.connection=function(){var a;return{goOnline:function(){a=!0,Andamio.dom.html.removeClass("is-offline")},goOffline:function(){a=!1,Andamio.dom.html.addClass("is-offline")},get status(){return a},get type(){return navigator.connection?navigator.connection.type:"ethernet"},get isFast(){return"wifi"===this.type||"ethernet"===this.type},init:function(){a=navigator.connection?"none"!==navigator.connection.type:navigator.onLine,Andamio.dom.doc.on("offline",this.goOffline),Andamio.dom.doc.on("online",this.goOnline)}}}(),Andamio.page=function(){var a=null;return{get activeRequest(){return a},abortRequest:function(){a&&(a.abort(),a=null)},doRequest:function(b,c,d,e){var f=function(a,b){var c=a.status,d="timeout"===b?'<h3 class="alert-title">'+Andamio.i18n.ajaxTimeout+"</h3>":'<h3 class="alert-title">'+Andamio.i18n.ajaxGeneralError+"</h3><p>"+b+" "+c+"</p>",f='<div class="alert alert-error">'+d+'<a href="javascript:void(0)" class="button button-primary button-block action-refresh">'+Andamio.i18n.ajaxRetry+"</a>";"timeout"===b&&Andamio.connection.goOffline(),e(f,b)},g=function(a){Andamio.connection.goOnline(),Andamio.cache.set(b,a,c),e(a)},h=function(){a=null},i={"X-PJAX":!0,"X-Requested-With":"XMLHttpRequest","X-Fast-Connection":Andamio.connection.isFast};Andamio.config.custom_headers&&$.each(Andamio.config.custom_headers,function(a,b){i[a]=$.isFunction(b)?b():b}),Andamio.config.pageUrlSuffix&&(b+=Andamio.config.pageUrlSuffix),a=$.ajax({url:b,cache:d,data:Andamio.config.pageData||"",headers:i,error:f,success:g,complete:h})},load:function(a,b,c,d){var e=Andamio.cache.get(a);e?d(e):this.doRequest(a,b,c,d)},refresh:function(a,b,c){var d=Andamio.cache.get(a);d?this.doRequest(a,b,!1,function(a,b){b?c(d,b):c(a)}):this.doRequest(a,b,!1,c)}}}(),Andamio.pager=function(){function a(a){this.errorMessage=$('<div class="alert alert-error display-none">'+Andamio.i18n.pagerErrorMessage+"</div>"),this.loadMoreAction=$('<div class="pager-action"></div>').append(this.errorMessage).append($('<a href="javascript:void(0)" class="button button-block action-load-more">'+Andamio.i18n.pagerLoadMore+"</a>")),this.spinner=$('<div class="pager-loading display-none"><i class="icon icon-spinner-light"></i><span class="icon-text">'+Andamio.i18n.pagerLoading+"</span></div>"),this.noMorePages=$('<div class="pager-action">'+Andamio.i18n.pagerNoMorePages+"</div>"),this.scroller=Andamio.views.currentView.scroller,this.scrollerHeight=this.scroller.height(),this.scrollerScrollHeight=this.scroller[0].scrollHeight||Andamio.dom.viewport.height(),this.scrollCallback=null,this.status=!1,this.loading=!1,this.options=a,this.enable()}return a.prototype.showSpinner=function(){this.errorMessage.addClass("display-none"),this.spinner.removeClass("display-none"),this.loadMoreAction.addClass("display-none")},a.prototype.hideSpinner=function(){this.errorMessage.addClass("display-none"),this.spinner.addClass("display-none"),this.loadMoreAction.removeClass("display-none")},a.prototype.updateScroller=function(){this.options.pageNumber>=this.options.autoFetchMax?this.disableAutofetch():(this.scrollerHeight=this.scroller.height(),this.scrollerScrollHeight=this.scroller[0].scrollHeight||Andamio.dom.viewport.height())},a.prototype.onScroll=function(){if(!this.loading){var a=Andamio.views.currentView.scrollPosition;a+this.scrollerHeight+this.options.autoFetchThreshold>=this.scrollerScrollHeight&&this.loadNextPage()}},a.prototype.enableAutofetch=function(){var a=this,b=null;this.showSpinner(),this.scrollCallback=function(){b&&(clearTimeout(b),b=null),b=setTimeout($.proxy(a.onScroll,a),250)},this.scroller.on("scroll",this.scrollCallback)},a.prototype.disableAutofetch=function(){this.hideSpinner(),this.scroller.off("scroll",this.scrollCallback)},a.prototype.enable=function(){var a=this;this.options.pagerWrapper.length>0&&this.options.itemsPerPage<=this.options.pagerWrapper[0].children.length&&(this.status=!0,this.loadMoreAction.on("click",$.proxy(a.loadNextPage,a)).insertAfter(this.options.pagerWrapper),this.spinner.insertAfter(this.options.pagerWrapper),this.options.autoFetch&&this.enableAutofetch())},a.prototype.disable=function(){this.status=!1,this.loadMoreAction.off("click").remove(),this.spinner.remove(),this.options.autoFetch&&this.disableAutofetch()},a.prototype.loadNextPage=function(){if(!this.loading&&this.status){this.loading=!0,this.options.pageNumber++,this.options.autoFetch||this.showSpinner();var a=this;Andamio.page.abortRequest(),Andamio.page.load(this.options.url+this.options.pageNumber,this.options.expires,!0,function(b,c){if(c)a.disableAutofetch(),a.loadMoreAction.removeClass("display-none"),a.errorMessage.removeClass("display-none"),a.loading=!1,a.options.pageNumber--;else{a.errorMessage.addClass("display-none");var d=!1,e=a.options.pagerWrapper.children().length;b&&($.isPlainObject(b)?$.isEmptyObject(b.content)||(d=b.content):d=b),a.options.pagerWrapper[0].insertAdjacentHTML("beforeend",d),a.options.pageNumber<a.options.autoFetchMax?a.enableAutofetch():a.disableAutofetch(),a.loading=!1,a.options.autoFetch||a.hideSpinner(),a.options.pagerWrapper.children().length-e<a.options.itemsPerPage&&(a.disable(),a.noMorePages.insertAfter(a.options.pagerWrapper)),a.updateScroller(),$.isFunction(a.options.callback)&&a.options.callback(a.options.pageNumber)}})}},{init:function(b){var c={autoFetch:!0,autoFetchMax:3,autoFetchThreshold:100,callback:function(){},expires:null,itemsPerPage:10,pageNumber:0,pagerWrapper:Andamio.views.currentView.content.find(".js-pager-list"),queryParam:!0,url:Andamio.config.server};return $.extend(c,b),c.queryParam&&(c.url+=-1===c.url.indexOf("?")?"?page=":"&page="),new a(c)}}}(),Andamio.dom.pageAlert=$(".js-page-alert"),Object.defineProperties(Andamio.dom,{pageAlertText:{get:function(){return this.pageAlert.find(".js-page-alert-text").text()},set:function(a){this.pageAlert.find(".js-page-alert-text").html(a)}}}),Andamio.alert=function(){var a;return{show:function(b){b&&(Andamio.dom.pageAlertText=b),a=!0,Andamio.dom.pageAlert.removeClass("display-none")},hide:function(){a=!1,Andamio.dom.pageAlert.addClass("display-none")},get status(){return a},init:function(){a=!1,Andamio.events.attach(".action-hide-alert",this.hide),Andamio.dom.doc.on("Andamio:views:activateView:start",this.hide)}}}(),Andamio.dom.pageLoader=$(".js-page-loader"),Andamio.dom.pageLoaderImg=Andamio.dom.pageLoader.find(".js-page-loader-spinner"),Object.defineProperties(Andamio.dom,{pageLoaderText:{get:function(){return this.pageLoader.find(".js-page-loader-text").text()},set:function(a){this.pageLoader.find(".js-page-loader-text").html(a)}}}),Andamio.loader=function(){var a;return{show:function(b){a=!0,b="string"==typeof b?b:Andamio.i18n.pageLoaderText,Andamio.dom.pageLoaderText=b,Andamio.config.tmgcontainer?navigator.spinner&&navigator.spinner.show({message:b}):Andamio.dom.pageLoader.removeClass("display-none")},hide:function(){a=!1,Andamio.config.tmgcontainer?navigator.spinner&&navigator.spinner.hide():Andamio.dom.pageLoader.addClass("display-none")},get status(){return a},init:function(){a=!1;var b,c=this;Andamio.dom.doc.on("Andamio:views:activateView:start",function(){b=setTimeout(function(){c.show()},250)}),Andamio.dom.doc.on("Andamio:views:activateView:finish",function(){clearTimeout(b),c.hide()}),Andamio.dom.doc.on("ajaxError",function(){clearTimeout(b),c.hide()})}}}(),Andamio.dom.pageNav=$(".js-page-navigation"),Andamio.dom.pageNavItems=Andamio.dom.pageNav.find(".action-nav-item"),Object.defineProperties(Andamio.dom,{pageNavActive:{get:function(){return this.pageNavItems.filter(".active")},set:function(a){$.contains(this.pageNav[0],a[0])&&(this.pageNavActive.removeClass("active"),a.addClass("active"))}}}),Andamio.nav=function(){function a(a){Andamio.dom.viewport.height(a),Andamio.dom.pageView.height(a)}var b,c,d;return{show:function(){b=!0,Andamio.config.webapp&&Andamio.events.lock(),Andamio.dom.html.addClass("has-navigation"),Andamio.config.webapp||a(d)},hide:function(){b=!1,Andamio.config.webapp&&Andamio.events.lock(),Andamio.dom.html.removeClass("has-navigation"),Andamio.config.webapp||a("")},get status(){return b},init:function(){var a=this;b=Andamio.dom.html.hasClass("has-navigation"),Andamio.config.webapp||(c=Andamio.dom.win[0].innerHeight,d=Andamio.dom.pageNav.height(),c>d&&(d=c,Andamio.dom.pageNav.height(d))),Andamio.events.attach(".action-show-nav",a.show),Andamio.events.attach(".action-hide-nav",a.hide),Andamio.config.touch&&Andamio.dom.doc.on("touchmove",".action-hide-nav",function(a){a.preventDefault()}),Andamio.events.attach(".action-nav-item",function(b){var c=$(b.currentTarget),d=Andamio.util.getUrl(c),e=Andamio.util.getTitle(c);return Andamio.dom.pageNavActive[0]!==c[0]||$.os.tablet?(Andamio.dom.pageNavActive=c,$.os.tablet||a.hide(),e&&(Andamio.views.parentView.title=e),d&&Andamio.views.openParentPage(d),void 0):(a.hide(),void 0)})}}}(),Andamio.pulltorefresh=function(){function a(a,b){if(!a.scroller)throw"view must have a scroller";this.view=a,this.scrollCache=0,this.options=b,this.active=!1,this.loading=!1,this.enable()}return a.prototype={enable:function(){this.active=!0,this.loading=!1,this.view.scroller.addClass("has-pull-to-refresh").on("touchmove",$.proxy(this.onTouchMove,this)).on("touchstart",$.proxy(this.onTouchStart,this)).on("touchend",$.proxy(this.onTouchEnd,this))},disable:function(){this.view.scroller.removeClass("has-pull-to-refresh").off("touchmove",$.proxy(this.onTouchMove,this)).off("touchstart",$.proxy(this.onTouchStart,this)).off("touchend",$.proxy(this.onTouchEnd,this)),this.active=!1,this.loading=!1},onTouchStart:function(){this.scrollCache=this.view.scrollPosition},onTouchMove:function(){this.scrollCache>this.options.offset||(this.view.scrollPosition<this.options.threshold?this.view.scroller.addClass("can-refresh"):this.view.scroller.removeClass("can-refresh"))},onTouchEnd:function(){if(this.scrollCache=this.view.scrollPosition,!(this.scrollCache>this.options.offset)&&this.scrollCache<this.options.threshold){this.loading=!0,this.view.scroller.addClass("is-refreshing").removeClass("can-refresh"),Andamio.views.currentView.content[0].innerHTML="",Andamio.loader.show();var a=this.onRefreshEnd.call(this);Andamio.util.delay(function(){Andamio.views.refreshView(Andamio.views.currentView,a)},300)}},onRefreshEnd:function(){this.loading=!1,this.view.scroller.removeClass("is-refreshing"),this.options.callback()}},{init:function(b,c){var d={callback:function(){},threshold:-50,offset:150};return $.extend(d,c),new a(b,d)}}}(),Andamio.reveal=function(){return{init:function(){Andamio.events.attach(".action-reveal",function(a){var b,c,d,e="active",f="."+e,g=$(a.currentTarget);g&&(b=g.siblings(f),b&&b.removeClass(e),g.addClass(e),d=Andamio.util.getUrl(g),d&&(c=$(d).siblings(f),c&&c.removeClass("active"),$(d).addClass(e),a.preventDefault()))})}}}(),Andamio.slideshow=function(){function a(a){this.wrapper=$('<div class="slideshow-dots">');for(var b=0;a>b;b++)this.wrapper.append($('<div class="slideshow-dot"></div>'));this.items=this.wrapper.find(".slideshow-dot"),Object.defineProperties(this,{active:{get:function(){return this.wrapper.find(".active")},set:function(a){this.wrapper.find(".active").removeClass("active"),$(a).addClass("active")}}}),this.active=this.items.first()}function b(b,c,d){var e=this;this.options={callback:function(a,b){e.dots.active=e.dots.items[a],$.isFunction(d)&&d(a,b)}},$.extend(this.options,c),this.id=b,this.wrapper=$("#"+b),this.slideshow=new Swipe(document.getElementById(b),this.options),this.dots=new a(this.slideshow.getNumSlides()),this.dots.wrapper.insertAfter(e.wrapper).on("click",function(a){var b=a.target;e.dots.items.each(function(a,c){c===b&&e.slideshow.slide(a,300)})}),this.wrapper.find(".js-slideshow-media").each(function(a,b){var c=$(b),d=c.data("src");c.css("background-image","url("+d+")")}),this.wrapper.on("click",".action-slideshow-next",this.slideshow.next).on("click",".action-slideshow-prev",this.slideshow.prev)}return b.prototype.destroy=function(){this.slideshow.kill(),this.dots.wrapper.off("click").remove(),this.wrapper.off("click",".action-slideshow-next",this.slideshow.next).off("click",".action-slideshow-prev",this.slideshow.prev),this.wrapper.find(".slideshow-container").css("width","")},{init:function(a,c,d){return $("#"+a).find(".slideshow-item").length>1?new b(a,c,d):void 0}}}(),Andamio.dom.pageTabs=$(".js-page-tabs"),Andamio.dom.pageTabsItems=Andamio.dom.pageTabs.find(".action-tab-item"),Object.defineProperties(Andamio.dom,{pageTabsActive:{get:function(){return this.pageTabsItems.filter(".active")},set:function(a){$.contains(this.pageTabs[0],a[0])&&(this.pageTabsActive.removeClass("active"),a.addClass("active"))}}}),Andamio.tabs=function(){var a;return{show:function(){a=!0,Andamio.dom.html.addClass("has-page-tabs")},hide:function(){a=!1,Andamio.dom.html.removeClass("has-page-tabs")},get status(){return a},init:function(){a=Andamio.dom.html.hasClass("has-page-tabs"),Andamio.events.attach(".action-show-tabs",Andamio.tabs.show),Andamio.events.attach(".action-hide-tabs",Andamio.tabs.hide),Andamio.events.attach(".action-tab-item",function(a){var b=$(a.currentTarget),c=Andamio.util.getUrl(b),d=Andamio.util.getTitle(b);Andamio.views.currentUrl!==c&&(Andamio.dom.pageTabsActive=b,d&&(Andamio.views.parentView.title=d),Andamio.views.openParentPage(c))})}}}(),Andamio.dom.pageView=$(".js-page-view"),Andamio.dom.parentView=$(".js-parent-view"),Andamio.dom.childView=$(".js-child-view"),Andamio.dom.childViewAlt=$(".js-child-view-alternate"),Andamio.dom.modalView=$(".js-modal-view"),Andamio.dom.mediaView=$(".js-media-view"),Andamio.views=function(){"use strict";function a(a,b,c){this.name=a,this.container=b,this.url="",c&&(this.initialPosition=c,this.position=c)}a.prototype={slide:function(a){if(this.position||this.initialPosition){var b=this.position,c=this.container,d=function(a,b){var c="slide-",d={left:"right",right:"left",top:"bottom",bottom:"top","default":"default"};a=a.substr(c.length,a.length),b=b.substr(c.length,b.length);var e=c+("default"===a?"out-to-"+b:"in-from-"+a);return{a:e,b:c+b,c:e+" "+c+a+" "+c+d[a]}}(b,a);Andamio.events.lock(),c.addClass(d.a).one("webkitTransitionEnd",function(){c.addClass(d.b).removeClass(d.c),Andamio.events.unlock()}),this.position=a}},reset:function(){this.position&&Andamio.config.webapp&&(this.position=this.initialPosition,this.container.removeClass("slide-left slide-right slide-default slide-bottom").addClass(this.position)),this.active=!1,this.scrollPosition=0}},Object.defineProperties(a.prototype,{title:{configurable:!0,get:function(){return this.container.find(".js-title")},set:function(a){"string"==typeof a&&this.container.find(".js-title").text(a)}},content:{configurable:!0,get:function(){return this.container.hasClass("js-content")?this.container:this.container.find(".js-content")}},scroller:{configurable:!0,get:function(){return Andamio.config.webapp?this.container.hasClass("overthrow")?this.container:this.container.find(".overthrow"):Andamio.dom.win}},scrollPosition:{get:function(){return Andamio.config.webapp?this.scroller[0].scrollTop:Andamio.dom.viewport[0].scrollTop},set:function(a){Andamio.config.webapp&&this.scroller.length?this.scroller[0].scrollTop=a:Andamio.dom.viewport[0].scrollTop=a}},active:{get:function(){return this.container.hasClass("view-active")},set:function(a){a?this.container.addClass("view-active").removeClass("view-hidden"):this.container.addClass("view-hidden").removeClass("view-active")}},expiration:{get:function(){return Andamio.config.expiration[this.name]||Andamio.config.expiration.all}}});var b,c,d,e,f;return{parentView:new a("parentView",Andamio.dom.parentView,"slide-default"),childView:new a("childView",Andamio.dom.childView,"slide-right"),childViewAlt:new a("childViewAlt",Andamio.dom.childViewAlt,"slide-right"),modalView:new a("modalView",Andamio.dom.modalView,"slide-bottom"),mediaView:new a("mediaView",Andamio.dom.mediaView,"slide-bottom"),urlHistory:[],viewHistory:[],scrollHistory:[],childCount:0,modalCount:0,mediaCount:0,get currentUrl(){return Andamio.util.last(this.urlHistory)},set currentUrl(a){Andamio.util.addUniq(a,this.urlHistory)},get previousUrl(){return Andamio.util.prev(this.urlHistory)},get currentView(){return Andamio.util.last(this.viewHistory)},set currentView(a){this.viewHistory.push(a)},get previousView(){return Andamio.util.prev(this.viewHistory)},get previousScrollPosition(){return Andamio.util.last(this.scrollHistory)},set previousScrollPosition(a){this.scrollHistory.push(a)},resetViews:function(){b.reset(),c.reset(),d.reset(),e.reset(),f.reset(),this.viewHistory=[],this.urlHistory=[],this.scrollHistory=[],this.childCount=0,this.modalCount=0},loadView:function(a,b,c,d,e){var f=function(f,g){a.content[0].innerHTML=f,this.currentUrl=b,a.url=b,"number"==typeof c&&a.scroller.length&&(a.scrollPosition=c),g||Andamio.dom.doc.trigger("Andamio:views:activateView:finish",[a,e?"refresh":"load",b]),$.isFunction(d)&&d()};Andamio.page.abortRequest(),a.content[0].innerHTML="",Andamio.dom.doc.trigger("Andamio:views:activateView:start",[a,e?"refresh":"load",b]),e?Andamio.page.refresh(b,a.expiration,$.proxy(f,this)):Andamio.page.load(b,a.expiration,!1,$.proxy(f,this))},activateView:function(a,b,c,d){a.active=!0,Andamio.dom.html.addClass("has-"+a.name),b?this.loadView(a,b,c,null,d):(Andamio.dom.doc.trigger("Andamio:views:activateView:start",[a,"load",this.currentUrl]),Andamio.dom.doc.trigger("Andamio:views:activateView:finish",[a,"load",this.currentUrl]))},refreshView:function(a,b){a=a||this.currentView,a.url&&this.loadView(a,a.url,0,b,"refresh")},deactivateView:function(a){a.active=!1,Andamio.dom.html.removeClass("has-"+a.name)},pushView:function(a,b,c,d){this.currentView=a,this.previousView&&(this.previousScrollPosition=this.previousView.scrollPosition,this.deactivateView(this.previousView)),this.activateView(a,b,c,d)},popView:function(){this.previousView&&(this.deactivateView(this.currentView),this.viewHistory.pop(),this.urlHistory.length>1&&this.urlHistory.pop(),1===this.childCount||this.modalCount||this.mediaCount?this.activateView(this.currentView):this.activateView(this.currentView,this.currentUrl,this.previousScrollPosition),this.scrollHistory.pop())},openParentPage:function(a,c){this.resetViews(),this.pushView(b,a,0,c)},pushModal:function(a,b){return this.modalCount>0?!1:(Andamio.config.webapp&&e.slide("slide-default"),this.pushView(e,a,0,b),this.modalCount++,void 0)},popModal:function(){return this.modalCount>0?(Andamio.config.webapp&&e.slide("slide-bottom"),this.popView(),this.modalCount--,void 0):!1},pushMedia:function(a,b){return this.mediaCount>0?!1:(Andamio.config.webapp&&f.slide("slide-default"),this.pushView(f,a,0,b),this.mediaCount++,void 0)},popMedia:function(){return this.mediaCount>0?(Andamio.config.webapp&&f.slide("slide-bottom"),this.popView(),this.mediaCount--,void 0):!1},pushChild:function(a,e){if(a===Andamio.views.currentUrl)return Andamio.config.webapp?$.scrollElement(this.currentView.scroller[0],0):this.currentView.scrollPosition=0,void 0;switch(this.childCount++,this.currentView){case b:this.pushView(c,a,0,e),Andamio.config.webapp&&(b.slide("slide-left"),c.slide("slide-default"));break;case c:this.pushView(d,a,0,e),Andamio.config.webapp&&(d.container.removeClass("slide-left").addClass("slide-right"),Andamio.util.delay(function(){c.slide("slide-left"),d.slide("slide-default")},0));break;case d:this.pushView(c,a,0,e),Andamio.config.webapp&&(c.container.removeClass("slide-left").addClass("slide-right"),Andamio.util.delay(function(){d.slide("slide-left"),c.slide("slide-default")},0))}},popChild:function(){var a=this.currentView;if(Andamio.config.webapp)switch(a){case b:return;case c:1===this.childCount?(b.slide("slide-default"),c.slide("slide-right")):(d.container.removeClass("slide-right").addClass("slide-left"),Andamio.util.delay(function(){c.slide("slide-right"),d.slide("slide-default")},0));break;case d:c.container.removeClass("slide-right").addClass("slide-left"),Andamio.util.delay(function(){d.slide("slide-right"),c.slide("slide-default")},0)}this.popView(),this.childCount--},init:function(){var a,g,h=this;b=this.parentView,c=this.childView,d=this.childViewAlt,e=this.modalView,f=this.mediaView,h.resetViews(),"string"==typeof Andamio.config.initialView?h.openParentPage(Andamio.config.initialView,null,"refresh"):(h.openParentPage(),h.currentUrl=Andamio.config.server),Andamio.events.attach(".action-push",function(b){a=$(b.currentTarget),g=Andamio.util.getUrl(a),h.pushChild(g)},!0),Andamio.events.attach(".action-pop",function(){h.popChild()},!0),Andamio.events.attach(".action-show-modal",function(b){a=$(b.currentTarget),g=Andamio.util.getUrl(a),Andamio.nav.status&&!$.os.tablet&&Andamio.nav.hide(),h.pushModal(g)},!0),Andamio.events.attach(".action-hide-modal",function(){h.popModal()},!0),Andamio.events.attach(".action-show-media",function(b){a=$(b.currentTarget),g=Andamio.util.getUrl(a),Andamio.nav.status&&!$.os.tablet&&Andamio.nav.hide(),h.pushMedia(g)},!0),Andamio.events.attach(".action-hide-media",function(){h.popMedia()},!0),Andamio.events.attach(".action-refresh",function(){h.refreshView()},!0),Andamio.config.webapp&&Andamio.config.touch&&Andamio.dom.doc.on("swipeRight",".child-view",function(){h.popChild()})}}}(),Andamio.init=function(a){Andamio.config.init(a),Andamio.container.init(),Andamio.alert.init(),Andamio.cache.init(),Andamio.connection.init(),Andamio.loader.init(),Andamio.views.init(),Andamio.nav.init(),Andamio.reveal.init(),Andamio.tabs.init()};