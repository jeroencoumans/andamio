window.Andamio={},Andamio.dom=function(){return{win:$(window),doc:$(window.document),html:$("html"),viewport:$(".viewport")}}(),Andamio.i18n={ajaxGeneralError:"Computer said no:",ajaxNotFound:"The page couldn't be found.",ajaxTimeout:"The server timed out waiting for the request.",ajaxServerError:"The server is having problems, try again later.",ajaxRetry:"Load again",offlineMessage:"It seems your internet connection is offline.",pagerLoadMore:"Load more",pagerLoading:"Loading&hellip;",pagerNoMorePages:"There are no more items.",pagerErrorMessage:"There was an error loading more pages"},Andamio.config=function(){var i=function(i){var t=this.os={},e=this.browser={},o=i.match(/WebKit\/([\d.]+)/),n=i.match(/(Android)\s+([\d.]+)/),a=i.match(/(iPad).*OS\s([\d_]+)/),s=!a&&i.match(/(iPhone\sOS)\s([\d_]+)/),r=i.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),d=r&&i.match(/TouchPad/),c=i.match(/Kindle\/([\d.]+)/),l=i.match(/Silk\/([\d._]+)/),h=i.match(/(BlackBerry).*Version\/([\d.]+)/),u=i.match(/(BB10).*Version\/([\d.]+)/),m=i.match(/(RIM\sTablet\sOS)\s([\d.]+)/),p=i.match(/PlayBook/),f=i.match(/Chrome\/([\d.]+)/)||i.match(/CriOS\/([\d.]+)/),g=i.match(/Firefox\/([\d.]+)/);(e.webkit=!!o)&&(e.version=o[1]),n&&(t.android=!0,t.version=n[2]),s&&(t.ios=t.iphone=!0,t.version=s[2].replace(/_/g,".")),a&&(t.ios=t.ipad=!0,t.version=a[2].replace(/_/g,".")),r&&(t.webos=!0,t.version=r[2]),d&&(t.touchpad=!0),h&&(t.blackberry=!0,t.version=h[2]),u&&(t.bb10=!0,t.version=u[2]),m&&(t.rimtabletos=!0,t.version=m[2]),p&&(e.playbook=!0),c&&(t.kindle=!0,t.version=c[1]),l&&(e.silk=!0,e.version=l[1]),!l&&t.android&&i.match(/Kindle Fire/)&&(e.silk=!0),f&&(e.chrome=!0,e.version=f[1]),g&&(e.firefox=!0,e.version=g[1]),t.tablet=!!(a||p||n&&!i.match(/Mobile/)||g&&i.match(/Tablet/)),t.phone=!(t.tablet||!(n||s||r||h||u||f&&i.match(/Android/)||f&&i.match(/CriOS\/([\d.]+)/)||g&&i.match(/Mobile/)))};return{init:function(t){i.call(this,navigator.userAgent),this.os.ios&&(this.os.ios5=-1!==this.os.version.indexOf("5."),this.os.ios6=-1!==this.os.version.indexOf("6.")),this.os.android&&(this.os.android2=this.os.version>="2"&&"4">this.os.version,this.os.android4=this.os.version>="4"&&"5">this.os.version);var e=window;if(this.webapp=e.location.search.search("webapp")>0||e.navigator.standalone||Andamio.dom.html.hasClass("webapp"),this.tmgcontainer=e.navigator.userAgent.indexOf("TMGContainer")>-1,this.server=e.location.origin+e.location.pathname,this.touch="ontouchstart"in e,this.cache=window.lscache?window.lscache.supported():!1,this.expiration={all:1440,parentView:30},Andamio.dom.doc.width()>=980&&(this.os.tablet=!0),this.touch?this.fastclick=new FastClick(e.document.body):Andamio.dom.html.addClass("no-touch"),"object"==typeof t)for(var o in t)switch(o){case"init":break;case"i18n":for(var n in t.i18n)Andamio.i18n[n]=t.i18n[n];break;default:this[o]=t[o]}this.tmgcontainer&&(this.webapp=!0),this.os.tablet&&(Andamio.dom.html.addClass("tablet"),Andamio.nav.show(),this.webapp=!0),this.webapp?Andamio.dom.html.removeClass("website").addClass("webapp"):Andamio.dom.html.removeClass("webapp").addClass("website"),this.website=!this.webapp;for(var a in this.os)Andamio.config.os[a]&&"version"!==a&&Andamio.dom.html.addClass(a)}}}(),Andamio.events=function(){var i,t=!1;return{get status(){return t},lock:function(e){t||(t=!0,e="number"==typeof e&&e>0?e:300,i=setTimeout(function(){t=!1},e))},unlock:function(){clearTimeout(i),t=!1},attach:function(i,e,o,n){Andamio.dom.viewport.on("click",i,function(i){return t||(o&&Andamio.events.lock(n),e(i)),!1})},detach:function(i){Andamio.dom.viewport.off("click",i)}}}(),Andamio.util=function(){return{last:function(i){return i.length>0?i[i.length-1]:void 0},prev:function(i){return i&&i.length>1?i[i.length-2]:void 0},addUniq:function(i,t){i!==this.last(t)&&t.push(i)},addOnly:function(i,t){0>t.indexOf(i)&&t.push(i)},getUrl:function(i){var t=0!==$(i).attr("href").indexOf("javascript")?$(i).attr("href"):!1;return $(i).data("url")||t||$(i).hash},getTitle:function(i){return $(i).data("title")||$(i).text()}}}(),Andamio.util.delay=function(){var i=0;return function(t,e){clearTimeout(i),i=setTimeout(t,e)}}(),Andamio.container=function(){function i(){Andamio.config.phone={updateTimestamp:new Date,updateTimeout:1e3*Andamio.config.expiration.parentView},navigator.splashscreen&&navigator.splashscreen.hide(),Andamio.events.attach(".action-external",function(i){var t=$(i.currentTarget),e=t.attr("href");navigator.utility&&navigator.utility.openUrl&&navigator.utility.openUrl(e,"popover")}),Andamio.dom.doc.on("statusbartap",function(){var i=Andamio.nav.status?Andamio.dom.pageNav:Andamio.views.currentView.scroller;$.scrollTo?i.scrollTo(0,400):$.scrollElement&&$.scrollElement(i[0],0)}),Andamio.dom.doc.on("pause",function(){Andamio.config.phone.updateTimestamp=new Date}),Andamio.dom.doc.on("resume",function(){var i=new Date;i-Andamio.config.phone.updateTimestamp>Andamio.config.phone.updateTimeout&&Andamio.views.refreshView(Andamio.views.parentView)})}return{init:function(){navigator.bootstrap?navigator.bootstrap.addConstructor(i):Andamio.dom.doc.on("deviceready",i)}}}(),Andamio.cache=function(){var i;return{get:function(t){if(t&&i){var e=i.get(t);if(e)return e}},set:function(t,e,o){if(t&&e&&i){var n="number"==typeof o?o:Andamio.config.expiration.all;i.set(t,e,n)}},remove:function(t){t&&i&&i.remove(t)},flush:function(){i&&i.flush()},setBucket:function(t){i&&i.setBucket(t)},init:function(){i=Andamio.config.cache?window.lscache:!1}}}(),Andamio.connection=function(){var i;return{goOnline:function(){i=!0,Andamio.dom.html.removeClass("is-offline")},goOffline:function(){i=!1,Andamio.dom.html.addClass("is-offline")},get status(){return i},get type(){return navigator.connection?navigator.connection.type:"ethernet"},get isFast(){return"wifi"===this.type||"ethernet"===this.type},init:function(){i=navigator.connection?"none"!==navigator.connection.type:navigator.onLine,Andamio.dom.doc.on("offline",this.goOffline),Andamio.dom.doc.on("online",this.goOnline)}}}(),Andamio.page=function(){var i=null;return{get activeRequest(){return i},abortRequest:function(){i&&(i.abort(),i=null)},doRequest:function(t,e,o,n){var a=function(i,t){var e=i.status,o="timeout"===t?'<h3 class="alert-title">'+Andamio.i18n.ajaxTimeout+"</h3>":'<h3 class="alert-title">'+Andamio.i18n.ajaxGeneralError+"</h3><p>"+t+" "+e+"</p>",a='<div class="alert alert-error">'+o+'<a href="javascript:void(0)" class="button button-primary button-block action-refresh">'+Andamio.i18n.ajaxRetry+"</a>";"timeout"===t&&Andamio.connection.goOffline(),n(a,t)},s=function(i){Andamio.connection.goOnline(),Andamio.cache.set(t,i,e),n(i)},r=function(){i=null};i=$.ajax({url:t,cache:o,headers:{"X-PJAX":!0,"X-Requested-With":"XMLHttpRequest","X-Fast-Connection":Andamio.connection.isFast},error:a,success:s,complete:r})},load:function(i,t,e,o){var n=Andamio.cache.get(i);n?o(n):this.doRequest(i,t,e,o)},refresh:function(i,t,e){var o=Andamio.cache.get(i);o?this.doRequest(i,t,!1,function(i,t){t?e(o,t):e(i)}):this.doRequest(i,t,!1,e)}}}(),Andamio.pager=function(){function i(i){this.errorMessage=$('<div class="alert alert-error display-none">'+Andamio.i18n.pagerErrorMessage+"</div>"),this.loadMoreAction=$('<div class="pager-action"></div>').append(this.errorMessage).append($('<a href="javascript:void(0)" class="button button-block action-load-more">'+Andamio.i18n.pagerLoadMore+"</a>")),this.spinner=$('<div class="pager-loading display-none"><i class="icon icon-spinner-light"></i><span class="icon-text">'+Andamio.i18n.pagerLoading+"</span></div>"),this.noMorePages=$('<div class="pager-action">'+Andamio.i18n.pagerNoMorePages+"</div>"),this.scroller=Andamio.views.currentView.scroller,this.scrollerHeight=this.scroller.height(),this.scrollerScrollHeight=this.scroller[0].scrollHeight||Andamio.dom.viewport.height(),this.status=!1,this.loading=!1,this.options=i,this.enable()}return i.prototype.showSpinner=function(){this.errorMessage.addClass("display-none"),this.spinner.removeClass("display-none"),this.loadMoreAction.addClass("display-none")},i.prototype.hideSpinner=function(){this.errorMessage.addClass("display-none"),this.spinner.addClass("display-none"),this.loadMoreAction.removeClass("display-none")},i.prototype.updateScroller=function(){this.options.pageNumber>=this.options.autoFetchMax?this.disableAutofetch():(this.scrollerHeight=this.scroller.height(),this.scrollerScrollHeight=this.scroller[0].scrollHeight||Andamio.dom.viewport.height())},i.prototype.onScroll=function(){if(!this.loading){var i=Andamio.views.currentView.scrollPosition;i+this.scrollerHeight+this.options.autoFetchThreshold>=this.scrollerScrollHeight&&this.loadNextPage()}},i.prototype.enableAutofetch=function(){var i,t=this;this.showSpinner(),this.scroller.on("scroll",function(){i&&(clearTimeout(i),i=null),i=setTimeout($.proxy(t.onScroll,t),250)})},i.prototype.disableAutofetch=function(){this.hideSpinner(),this.scroller.off("scroll")},i.prototype.enable=function(){var i=this;this.options.pagerWrapper.length>0&&this.options.itemsPerPage<=this.options.pagerWrapper[0].children.length&&(this.status=!0,this.loadMoreAction.on("click",$.proxy(i.loadNextPage,i)).insertAfter(this.options.pagerWrapper),this.spinner.insertAfter(this.options.pagerWrapper),this.options.autoFetch&&this.enableAutofetch())},i.prototype.disable=function(){this.status=!1,this.loadMoreAction.off("click").remove(),this.spinner.remove(),this.noMorePages.insertAfter(this.options.pagerWrapper),this.options.autoFetch&&this.disableAutofetch()},i.prototype.loadNextPage=function(){if(!this.loading&&this.status){this.loading=!0,this.options.pageNumber++,this.options.autoFetch||this.showSpinner();var i=this;Andamio.page.abortRequest(),Andamio.page.load(this.options.url+this.options.pageNumber,this.options.expires,!0,function(t,e){if(e)i.disableAutofetch(),i.loadMoreAction.removeClass("display-none"),i.errorMessage.removeClass("display-none"),i.loading=!1,i.options.pageNumber--;else{i.errorMessage.addClass("display-none");var o=!1,n=i.options.pagerWrapper.children().length;t&&($.isPlainObject(t)?$.isEmptyObject(t.content)||(o=t.content):o=t),i.options.pagerWrapper[0].insertAdjacentHTML("beforeend",o),i.options.pageNumber<i.options.autoFetchMax?i.enableAutofetch():i.disableAutofetch(),i.loading=!1,i.options.autoFetch||i.hideSpinner(),i.options.pagerWrapper.children().length-n<i.options.itemsPerPage&&i.disable(),i.updateScroller(),$.isFunction(i.options.callback)&&i.options.callback(i.options.pageNumber)}})}},{init:function(t){var e={autoFetch:!0,autoFetchMax:3,autoFetchThreshold:100,callback:function(){},expires:null,itemsPerPage:10,pageNumber:0,pagerWrapper:Andamio.views.currentView.content.find(".js-pager-list"),queryParam:!0,url:Andamio.config.server};return $.extend(e,t),e.queryParam&&(e.url+=-1===e.url.indexOf("?")?"?page=":"&page="),new i(e)}}}(),Andamio.dom.pageAlert=$(".js-page-alert"),Object.defineProperties(Andamio.dom,{pageAlertText:{get:function(){return this.pageAlert.find(".js-page-alert-text").text()},set:function(i){this.pageAlert.find(".js-page-alert-text").html(i)}}}),Andamio.alert=function(){var i;return{show:function(t){t&&(Andamio.dom.pageAlertText=t),i=!0,Andamio.dom.pageAlert.removeClass("display-none")},hide:function(){i=!1,Andamio.dom.pageAlert.addClass("display-none")},get status(){return i},init:function(){i=!1,Andamio.events.attach(".action-hide-alert",this.hide),Andamio.dom.doc.on("Andamio:views:activateView:start",this.hide)}}}(),Andamio.dom.pageLoader=$(".js-page-loader"),Andamio.dom.pageLoaderImg=Andamio.dom.pageLoader.find(".js-page-loader-spinner"),Object.defineProperties(Andamio.dom,{pageLoaderText:{get:function(){return this.pageLoader.find(".js-page-loader-text").text()},set:function(i){this.pageLoader.find(".js-page-loader-text").html(i)}}}),Andamio.loader=function(){var i;return{show:function(t){i=!0,t&&(Andamio.dom.pageLoaderText=t),Andamio.config.tmgcontainer?navigator.spinner&&navigator.spinner.show({message:t}):Andamio.dom.pageLoader.removeClass("display-none")},hide:function(){i=!1,Andamio.config.tmgcontainer?navigator.spinner&&navigator.spinner.hide():Andamio.dom.pageLoader.addClass("display-none")},get status(){return i},init:function(){i=!1;var t,e=this;Andamio.dom.doc.on("Andamio:views:activateView:start",function(){t=setTimeout(function(){e.show()},250)}),Andamio.dom.doc.on("Andamio:views:activateView:finish",function(){clearTimeout(t),e.hide()}),Andamio.dom.doc.on("ajaxError",function(){clearTimeout(t),e.hide()})}}}(),Andamio.dom.pageNav=$(".js-page-navigation"),Andamio.dom.pageNavItems=Andamio.dom.pageNav.find(".action-nav-item"),Object.defineProperties(Andamio.dom,{pageNavActive:{get:function(){return this.pageNavItems.filter(".active")},set:function(i){$.contains(this.pageNav[0],i[0])&&(this.pageNavActive.removeClass("active"),i.addClass("active"))}}}),Andamio.nav=function(){function i(i){Andamio.dom.viewport.height(i),Andamio.dom.pageView.height(i)}var t,e,o;return{show:function(){t=!0,Andamio.config.webapp&&Andamio.events.lock(),Andamio.dom.html.addClass("has-navigation"),Andamio.config.webapp||i(o)},hide:function(){t=!1,Andamio.config.webapp&&Andamio.events.lock(),Andamio.dom.html.removeClass("has-navigation"),Andamio.config.webapp||i("")},get status(){return t},init:function(){var i=this;t=Andamio.dom.html.hasClass("has-navigation"),Andamio.config.webapp||(e=Andamio.dom.win.height(),o=Andamio.dom.pageNav.height(),Andamio.config.os.iphone&&(e+=60),e>o&&(o=e,Andamio.dom.pageNav.height(o))),Andamio.events.attach(".action-show-nav",i.show),Andamio.events.attach(".action-hide-nav",i.hide),Andamio.config.touch&&Andamio.dom.doc.on("touchmove",".action-hide-nav",function(i){i.preventDefault()}),Andamio.events.attach(".action-nav-item",function(t){var e=$(t.currentTarget),o=Andamio.util.getUrl(e),n=Andamio.util.getTitle(e);return Andamio.dom.pageNavActive[0]!==e[0]||Andamio.config.os.tablet?(Andamio.dom.pageNavActive=e,Andamio.config.os.tablet||i.hide(),n&&(Andamio.views.parentView.title=n),o&&Andamio.views.openParentPage(o),void 0):(i.hide(),void 0)})}}}(),Andamio.pulltorefresh=function(){function i(i,t){if(!i.scroller)throw"view must have a scroller";this.view=i,this.scrollCache=0,this.options=t,this.active=!1,this.loading=!1,this.enable()}return i.prototype={enable:function(){this.active=!0,this.loading=!1,this.view.scroller.addClass("has-pull-to-refresh").on("touchmove",$.proxy(this.onTouchMove,this)).on("touchstart",$.proxy(this.onTouchStart,this)).on("touchend",$.proxy(this.onTouchEnd,this))},disable:function(){this.view.scroller.removeClass("has-pull-to-refresh").off("touchmove",$.proxy(this.onTouchMove,this)).off("touchstart",$.proxy(this.onTouchStart,this)).off("touchend",$.proxy(this.onTouchEnd,this)),this.active=!1,this.loading=!1},onTouchStart:function(){this.scrollCache=this.view.scrollPosition},onTouchMove:function(){this.scrollCache>this.options.offset||(this.view.scrollPosition<this.options.threshold?this.view.scroller.addClass("can-refresh"):this.view.scroller.removeClass("can-refresh"))},onTouchEnd:function(){if(this.scrollCache=this.view.scrollPosition,!(this.scrollCache>this.options.offset)&&this.scrollCache<this.options.threshold){this.loading=!0,this.view.scroller.addClass("is-refreshing").removeClass("can-refresh"),Andamio.views.currentView.content[0].innerHTML="",Andamio.loader.show();var i=this.onRefreshEnd.call(this);Andamio.util.delay(function(){Andamio.views.refreshView(Andamio.views.currentView,i)},300)}},onRefreshEnd:function(){this.loading=!1,this.view.scroller.removeClass("is-refreshing"),this.options.callback()}},{init:function(t,e){var o={callback:function(){},threshold:-50,offset:150};return $.extend(o,e),new i(t,o)}}}(),Andamio.reveal=function(){return{init:function(){Andamio.events.attach(".action-reveal",function(i){var t,e,o,n="active",a="."+n,s=$(i.currentTarget);s&&(t=s.siblings(a),t&&t.removeClass(n),s.addClass(n),o=Andamio.util.getUrl(s),o&&(e=$(o).siblings(a),e&&e.removeClass("active"),$(o).addClass(n),i.preventDefault()))})}}}(),Andamio.slideshow=function(){function i(i){this.wrapper=$('<div class="slideshow-dots">');for(var t=0;i>t;t++)this.wrapper.append($('<div class="slideshow-dot"></div>'));this.items=this.wrapper.find(".slideshow-dot"),Object.defineProperties(this,{active:{get:function(){return this.wrapper.find(".active")},set:function(i){this.wrapper.find(".active").removeClass("active"),$(i).addClass("active")}}}),this.active=this.items.first()}function t(t,e,o){var n=this;this.options={callback:function(i,t){n.dots.active=n.dots.items[i],$.isFunction(o)&&o(i,t)}},$.extend(this.options,e),this.id=t,this.wrapper=$("#"+t),this.slideshow=new Swipe(document.getElementById(t),this.options),this.dots=new i(this.slideshow.getNumSlides()),this.dots.wrapper.insertAfter(n.wrapper).on("click",function(i){var t=i.target;n.dots.items.each(function(i,e){e===t&&n.slideshow.slide(i,300)})}),this.wrapper.find(".js-slideshow-media").each(function(i,t){var e=$(t),o=e.data("src");e.css("background-image","url("+o+")")}),this.wrapper.on("click",".action-slideshow-next",this.slideshow.next).on("click",".action-slideshow-prev",this.slideshow.prev)}return t.prototype.destroy=function(){this.slideshow.kill(),this.dots.wrapper.off("click").remove(),this.wrapper.off("click",".action-slideshow-next",this.slideshow.next).off("click",".action-slideshow-prev",this.slideshow.prev),this.wrapper.find(".slideshow-container").css("width","")},{init:function(i,e,o){return $("#"+i).find(".slideshow-item").length>1?new t(i,e,o):void 0}}}(),Andamio.dom.pageTabs=$(".js-page-tabs"),Andamio.dom.pageTabsItems=Andamio.dom.pageTabs.find(".action-tab-item"),Object.defineProperties(Andamio.dom,{pageTabsActive:{get:function(){return this.pageTabsItems.filter(".active")},set:function(i){$.contains(this.pageTabs[0],i[0])&&(this.pageTabsActive.removeClass("active"),i.addClass("active"))}}}),Andamio.tabs=function(){var i;return{show:function(){i=!0,Andamio.dom.html.addClass("has-page-tabs")},hide:function(){i=!1,Andamio.dom.html.removeClass("has-page-tabs")},get status(){return i},init:function(){i=Andamio.dom.html.hasClass("has-page-tabs"),Andamio.events.attach(".action-show-tabs",Andamio.tabs.show),Andamio.events.attach(".action-hide-tabs",Andamio.tabs.hide),Andamio.events.attach(".action-tab-item",function(i){var t=$(i.currentTarget),e=Andamio.util.getUrl(t),o=Andamio.util.getTitle(t);Andamio.views.currentUrl!==e&&(Andamio.dom.pageTabsActive=t,o&&(Andamio.views.parentView.title=o),Andamio.views.openParentPage(e))})}}}(),Andamio.dom.pageView=$(".js-page-view"),Andamio.dom.parentView=$(".js-parent-view"),Andamio.dom.childView=$(".js-child-view"),Andamio.dom.childViewAlt=$(".js-child-view-alternate"),Andamio.dom.modalView=$(".js-modal-view"),Andamio.dom.mediaView=$(".js-media-view"),Andamio.views=function(){function i(i,t,e){this.name=i,this.container=t,this.url="",e&&(this.initialPosition=e,this.position=e)}i.prototype={slide:function(i){if(this.position||this.initialPosition){var t=this.position,e=this.container,o=function(i,t){var e="slide-",o={left:"right",right:"left",top:"bottom",bottom:"top","default":"default"};i=i.substr(e.length,i.length),t=t.substr(e.length,t.length);var n=e+("default"===i?"out-to-"+t:"in-from-"+i);return{a:n,b:e+t,c:n+" "+e+i+" "+e+o[i]}}(t,i);Andamio.events.lock(),e.addClass(o.a).one("webkitTransitionEnd",function(){e.addClass(o.b).removeClass(o.c),Andamio.events.unlock()}),this.position=i}},reset:function(){this.position&&Andamio.config.webapp&&(this.position=this.initialPosition,this.container.removeClass("slide-left slide-right slide-default slide-bottom").addClass(this.position)),this.active=!1,this.scrollPosition=0}},Object.defineProperties(i.prototype,{title:{configurable:!0,get:function(){return this.container.find(".js-title")},set:function(i){"string"==typeof i&&this.container.find(".js-title").text(i)}},content:{configurable:!0,get:function(){return this.container.hasClass("js-content")?this.container:this.container.find(".js-content")}},scroller:{configurable:!0,get:function(){return Andamio.config.webapp?this.container.hasClass("overthrow")?this.container:this.container.find(".overthrow"):Andamio.dom.win}},scrollPosition:{get:function(){return Andamio.config.webapp?this.scroller[0].scrollTop:Andamio.dom.viewport[0].scrollTop},set:function(i){Andamio.config.webapp&&this.scroller.length?this.scroller[0].scrollTop=i:Andamio.dom.viewport[0].scrollTop=i}},active:{get:function(){return this.container.hasClass("view-active")},set:function(i){i?this.container.addClass("view-active").removeClass("view-hidden"):this.container.addClass("view-hidden").removeClass("view-active")}},expiration:{get:function(){return Andamio.config.expiration[this.name]||Andamio.config.expiration.all}}});var t,e,o,n,a;return{parentView:new i("parentView",Andamio.dom.parentView,"slide-default"),childView:new i("childView",Andamio.dom.childView,"slide-right"),childViewAlt:new i("childViewAlt",Andamio.dom.childViewAlt,"slide-right"),modalView:new i("modalView",Andamio.dom.modalView,"slide-bottom"),mediaView:new i("mediaView",Andamio.dom.mediaView,"slide-bottom"),urlHistory:[],viewHistory:[],scrollHistory:[],childCount:0,modalCount:0,mediaCount:0,get currentUrl(){return Andamio.util.last(this.urlHistory)},set currentUrl(i){Andamio.util.addUniq(i,this.urlHistory)},get previousUrl(){return Andamio.util.prev(this.urlHistory)},get currentView(){return Andamio.util.last(this.viewHistory)},set currentView(i){this.viewHistory.push(i)},get previousView(){return Andamio.util.prev(this.viewHistory)},get previousScrollPosition(){return Andamio.util.last(this.scrollHistory)},set previousScrollPosition(i){this.scrollHistory.push(i)},resetViews:function(){t.reset(),e.reset(),o.reset(),n.reset(),a.reset(),this.viewHistory=[],this.urlHistory=[],this.scrollHistory=[],this.childCount=0,this.modalCount=0},loadView:function(i,t,e,o,n){var a=function(a,s){i.content[0].innerHTML=a,this.currentUrl=t,i.url=t,"number"==typeof e&&i.scroller.length&&(i.scrollPosition=e),s||Andamio.dom.doc.trigger("Andamio:views:activateView:finish",[i,n?"refresh":"load",t]),$.isFunction(o)&&o()};Andamio.page.abortRequest(),i.content[0].innerHTML="",Andamio.dom.doc.trigger("Andamio:views:activateView:start",[i,n?"refresh":"load",t]),n?Andamio.page.refresh(t,i.expiration,$.proxy(a,this)):Andamio.page.load(t,i.expiration,!1,$.proxy(a,this))},activateView:function(i,t,e,o){i.active=!0,t?this.loadView(i,t,e,null,o):(Andamio.dom.doc.trigger("Andamio:views:activateView:start",[i,"load",this.currentUrl]),Andamio.dom.doc.trigger("Andamio:views:activateView:finish",[i,"load",this.currentUrl]))},refreshView:function(i,t){i=i||this.currentView,i.url&&this.loadView(i,i.url,0,t,"refresh")},deactivateView:function(i){i.active=!1},pushView:function(i,t,e,o){this.currentView=i,this.previousView&&(this.previousScrollPosition=this.previousView.scrollPosition,this.deactivateView(this.previousView)),this.activateView(i,t,e,o)},popView:function(){this.previousView&&(this.deactivateView(this.currentView),this.viewHistory.pop(),this.urlHistory.length>1&&this.urlHistory.pop(),1===this.childCount||this.modalCount||this.mediaCount?this.activateView(this.currentView):this.activateView(this.currentView,this.currentUrl,!1,this.previousScrollPosition),this.scrollHistory.pop())},openParentPage:function(i,e){this.resetViews(),this.pushView(t,i,0,e)},pushModal:function(i,t){return this.modalCount>0?!1:(Andamio.config.webapp&&n.slide("slide-default"),this.pushView(n,i,0,t),this.modalCount++,void 0)},popModal:function(){return this.modalCount>0?(Andamio.config.webapp&&n.slide("slide-bottom"),this.popView(),this.modalCount--,void 0):!1},pushMedia:function(i,t){return this.mediaCount>0?!1:(Andamio.config.webapp&&a.slide("slide-default"),this.pushView(a,i,0,t),this.mediaCount++,void 0)},popMedia:function(){return this.mediaCount>0?(Andamio.config.webapp&&a.slide("slide-bottom"),this.popView(),this.mediaCount--,void 0):!1},pushChild:function(i,n){if(i===Andamio.views.currentUrl)return Andamio.config.webapp?$.scrollElement(this.currentView.scroller[0],0):this.currentView.scrollPosition=0,void 0;switch(this.childCount++,this.currentView){case t:this.pushView(e,i,0,n),Andamio.config.webapp&&(t.slide("slide-left"),e.slide("slide-default"));break;case e:this.pushView(o,i,0,n),Andamio.config.webapp&&(o.container.removeClass("slide-left").addClass("slide-right"),Andamio.util.delay(function(){e.slide("slide-left"),o.slide("slide-default")},0));break;case o:this.pushView(e,i,0,n),Andamio.config.webapp&&(e.container.removeClass("slide-left").addClass("slide-right"),Andamio.util.delay(function(){o.slide("slide-left"),e.slide("slide-default")},0))}},popChild:function(){var i=this.currentView;if(Andamio.config.webapp)switch(i){case t:return;case e:1===this.childCount?(t.slide("slide-default"),e.slide("slide-right")):(o.container.removeClass("slide-right").addClass("slide-left"),Andamio.util.delay(function(){e.slide("slide-right"),o.slide("slide-default")},0));break;case o:e.container.removeClass("slide-right").addClass("slide-left"),Andamio.util.delay(function(){o.slide("slide-right"),e.slide("slide-default")},0)}this.popView(),this.childCount--},init:function(){var i,s,r=this;t=this.parentView,e=this.childView,o=this.childViewAlt,n=this.modalView,a=this.mediaView,r.resetViews(),"string"==typeof Andamio.config.initialView?r.openParentPage(Andamio.config.initialView,null,"refresh"):(r.openParentPage(),r.currentUrl=Andamio.config.server),Andamio.events.attach(".action-push",function(t){i=$(t.currentTarget),s=Andamio.util.getUrl(i),r.pushChild(s)},!0),Andamio.events.attach(".action-pop",function(){r.popChild()},!0),Andamio.events.attach(".action-show-modal",function(t){i=$(t.currentTarget),s=Andamio.util.getUrl(i),Andamio.nav.status&&!Andamio.config.os.tablet&&Andamio.nav.hide(),r.pushModal(s)},!0),Andamio.events.attach(".action-hide-modal",function(){r.popModal()},!0),Andamio.events.attach(".action-show-media",function(t){i=$(t.currentTarget),s=Andamio.util.getUrl(i),Andamio.nav.status&&!Andamio.config.os.tablet&&Andamio.nav.hide(),r.pushMedia(s)},!0),Andamio.events.attach(".action-hide-media",function(){r.popMedia()},!0),Andamio.events.attach(".action-refresh",function(){r.refreshView()},!0),Andamio.config.webapp&&Andamio.config.touch&&Andamio.dom.doc.on("swipeRight",".child-view",function(){r.popChild()})}}}(),Andamio.init=function(i){Andamio.config.init(i),Andamio.container.init(),Andamio.alert.init(),Andamio.cache.init(),Andamio.connection.init(),Andamio.loader.init(),Andamio.views.init(),Andamio.nav.init(),Andamio.reveal.init(),Andamio.config.webapp&&Andamio.tabs.init()};