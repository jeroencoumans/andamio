<div class="section-header">
    <h1 class="section-title">File: js&#x2F;app&#x2F;connection.js</h1>
</div>

<div class="box">
    <pre><code class="language-javascript" data-line="">
/**
 * Module that deals with internet connectivity
 * @author Jeroen Coumans
 * @class connection
 * @namespace APP
 */
APP.connection = (function () {

    // variables
    var connection,
        offlineMessage;

    /**
     * Called when the connection goes online, will hide the offline alert
     * @method goOnline
     * @private
     */
    function goOnline() {

        connection = "online";

        if (APP.alert.status()) {
            APP.alert.hide();
        }

        APP.dom.doc.trigger("APP:connection:online");
    }

    /**
     * Called when the connection goes offline, will show an offline alert
     * @method goOffline
     * @private
     */
    function goOffline() {

        connection = "offline";
        APP.alert.show(offlineMessage);

        APP.dom.doc.trigger("APP:connection:offline");
    }

    /**
     * Returns the status of the connection
     * @method status
     * @return {String} the connection, either <code>offline</code> or <code>online</code>
     *
     **/
    function getStatus() {

        return connection;
    }

    /**
     * Sets the status of the connection
     * @method status
     * @param [msg] {String} accepts <code>offline</code> or <code>online</code> to set the connection status
     * @return {String} the connection, either <code>offline</code> or <code>online</code>
     *
     **/
    function setStatus(msg) {

        // useful for testing offline / online
        if (msg === "offline") {
            goOffline();
        } else if (msg === "online") {
            goOnline();
        }

        return connection;
    }

    /**
     * Attach event listeners
     * @method attachListeners
     */
    function attachListeners() {

        APP.dom.doc.on("ajaxSuccess", function() {

            APP.connection.setStatus("online");
        });

        APP.dom.doc.on("ajaxError", function() {

            APP.connection.setStatus("offline");
        });
    }

    /***
     * Sets the default connection to online
     * @method init
     */
    function init(params) {

        offlineMessage = (params && params.offlineMessage) ? params.offlineMessage : '<a href="javascript:void(0)" class="action-refresh">De verbinding is verbroken. Probeer opnieuw.</a>';

        // set default connection to online
        goOnline();
        attachListeners();
    }

    return {
        "init": init,
        "getStatus": getStatus,
        "setStatus": setStatus
    };

})();
    </code></pre>
</div>

