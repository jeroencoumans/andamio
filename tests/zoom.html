<!DOCTYPE html>
<html lang="nl" class="webapp">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Andamio">
    <title>Andamio</title>
    <link rel="stylesheet" type="text/css" href="../dist/andamio.css">
</head>

<body class="viewport">

    <div class="overlay-total overthrow js-zoom-wrapper">
        <img src="http://placekitten.com/g/640/960" class="js-zoom-item media-fluid">
    </div>

    <div class="overlay-top-right overlay-high">
        <span class="button button-primary">Hoi Boris</span>
    </div>

    <script src="../dist/andamio.zepto.js"></script>

    <script>


Andamio.zoom = (function () {

    function Zoomable(options) {
        this.options = options;

        this.setup();
    }

    Zoomable.prototype = {

        setup: function () {

            var elem = this.options.elem,
                self = this;

            // Make sure we eat up all touch move events
            elem.on("touchmove", function (e) {

                e.stopPropagation();
            });

            elem.on("doubleTap", function () {

                // zoom in or out depending on wether we're already zoomed in
                self.scaleTo(null, self.options.current >= self.options.max ? self.options.min : self.options.max);
            });

            elem.on("gesturestart",  $.proxy(self.scaleStart, self));
            elem.on("gesturechange", $.proxy(self.scaleTo, self));
            elem.on("gestureend",    $.proxy(self.scaleEnd, self));
        },

        scaleStart: function (event) {

            console.log("Starting ");
        },

        scaleTo: function (event, scale) {

            var self = this,
                duration = scale ? 300 : 0,
                scale = event ? event.scale : scale;

            this.options.elem.animate({
                scale: scale
            }, {
                duration: duration,
                complete: function () {
                    self.options.current = scale;
                }
            });
        },

        scaleEnd: function () {

            console.log(this);

            var current = this.options.current,
                max     = this.options.max,
                min     = this.options.min,
                tooBig  = current > max,
                tooSmall = current < min;

            if (! tooBig && ! tooSmall) return;

            var scaleTo = tooBig ? max : min;

            var onComplete = function () {
                console.log("scaleEnd onComplete")
                current = scaleTo;
            }

            this.options.elem.animate({
                scale: scaleTo
            }, {
                duration: 300,
                easing: 'ease-out',
                complete: onComplete
            });
        },

        destroy: function () {

            this.options.elem.off("touchmove").off("doubleTap");
        }
    }

    return {

        init: function (params) {

            // Setup defaults
            var options = {
                min     : 1,
                max     : 3,
                current : 1,
                elem    : $(".js-zoom-wrapper")
            };

            $.extend(options, params);

            return new Zoomable(options);
        }
    };
})();

    var zoom = Andamio.zoom.init({ elem: $(".js-zoom-item")})

    </script>

</body>
</html>
